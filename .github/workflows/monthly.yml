name: Titan Auto-Trade

on:
  schedule:
    # ë§¤ì›” 1ì¼ UTC 00:00 (í•œêµ­ì‹œê°„ ì˜¤ì „ 9:00)
    - cron: '0 0 1 * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

permissions:
  contents: write

jobs:
  run-strategy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install pandas numpy yfinance fredapi scipy lxml requests openpyxl

      - name: Run Titan Strategy
        env:
          FRED_KEY: ${{ secrets.FRED_KEY }}
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: python main.py

      # [ë””ë²„ê¹…ìš©] íŒŒì¼ì´ ì§„ì§œ ìƒê²¼ëŠ”ì§€ ë¦¬ìŠ¤íŠ¸ í™•ì¸
      - name: Check Generated Files
        run: ls -R

      # [ìˆ˜ì •ë¨] ëª¨ë“  ë³€ê²½ì‚¬í•­(results í´ë” í¬í•¨) ìë™ ë°˜ì˜
      - name: Commit and Push Data
        run: |
          git config --global user.name "TitanBot"
          git config --global user.email "bot@titan.com"
          
          # í˜„ì¬ í´ë”ì˜ ëª¨ë“  ë³€ê²½ì‚¬í•­(ìƒˆ í´ë”, ìƒˆ íŒŒì¼, ìˆ˜ì •ëœ íŒŒì¼) ìŠ¤í…Œì´ì§•
          git add .
          
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ì—ëŸ¬ ë°©ì§€)
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ“ˆ Auto Update: $(date +'%Y-%m-%d')" && git push)
