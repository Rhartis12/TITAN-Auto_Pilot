<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan V6.9 Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <div class="flex justify-between items-center mb-8 border-b pb-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">üöÄ Titan V6.9 Dashboard</h1>
                <p class="text-gray-500" id="update-date">Last Updated: Loading...</p>
            </div>
            <div class="text-right">
                <div class="text-sm font-semibold text-gray-600">Current Regime</div>
                <div id="regime-badge" class="px-4 py-2 rounded-lg text-white font-bold bg-gray-400 mt-1">Loading...</div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-bold text-gray-700 mb-4">‚öñÔ∏è Factor Weights & Macro Z</h3>
                <canvas id="weightChart"></canvas>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-bold text-gray-700 mb-4">üí∞ Position Calculator</h3>
                <label class="block text-sm font-medium text-gray-700 mb-2">Total Seed Money ($)</label>
                <input type="number" id="seed-input" class="w-full p-2 border rounded mb-4" placeholder="Enter Amount (e.g. 10000)" value="10000">
                <button onclick="calculate()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Recalculate</button>
                <div class="mt-4 text-sm text-gray-600">
                    * Estimated shares are rounded down.
                </div>
            </div>
        </div>

        <h3 class="text-xl font-bold text-gray-800 mb-4">üìã This Month's Buy List</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="py-2 px-4 border text-left">Ticker</th>
                        <th class="py-2 px-4 border text-left">Sector</th>
                        <th class="py-2 px-4 border text-right">Price ($)</th>
                        <th class="py-2 px-4 border text-right">Weight</th>
                        <th class="py-2 px-4 border text-right bg-blue-50">Allocation ($)</th>
                        <th class="py-2 px-4 border text-right bg-blue-50">Shares</th>
                    </tr>
                </thead>
                <tbody id="port-table">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        let portfolioData = [];

        async function loadData() {
            try {
                const response = await fetch('dashboard_data.json');
                const data = await response.json();
                
                // Update Header
                document.getElementById('update-date').innerText = `Last Updated: ${data.date}`;
                const regimeEl = document.getElementById('regime-badge');
                regimeEl.innerText = data.regime.status;
                
                if(data.regime.status.includes("Stagflation")) regimeEl.className += " bg-red-500";
                else if(data.regime.status.includes("Recession")) regimeEl.className += " bg-blue-500";
                else if(data.regime.status.includes("Overheat")) regimeEl.className += " bg-orange-500";
                else regimeEl.className += " bg-green-500";

                // Update Chart
                const ctx = document.getElementById('weightChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Value', 'Momentum', 'LowVol', 'Quality'],
                        datasets: [{
                            data: [data.weights.VALUE, data.weights.MOM, data.weights.LOWVOL, data.weights.QUALITY],
                            backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#ef4444']
                        }]
                    }
                });

                portfolioData = data.portfolio;
                calculate(); // Initial Calc

            } catch (error) {
                console.error("Error loading JSON:", error);
            }
        }

        function calculate() {
            const seed = parseFloat(document.getElementById('seed-input').value) || 0;
            const tbody = document.getElementById('port-table');
            tbody.innerHTML = '';

            portfolioData.forEach(item => {
                const allocAmt = seed * item.weight;
                const shares = Math.floor(allocAmt / item.price);
                
                const tr = `
                    <tr class="hover:bg-gray-50">
                        <td class="py-2 px-4 border font-bold text-blue-600">${item.ticker}</td>
                        <td class="py-2 px-4 border text-sm text-gray-600">${item.sector}</td>
                        <td class="py-2 px-4 border text-right">$${item.price.toFixed(2)}</td>
                        <td class="py-2 px-4 border text-right">${(item.weight * 100).toFixed(1)}%</td>
                        <td class="py-2 px-4 border text-right font-semibold bg-blue-50">$${allocAmt.toFixed(2)}</td>
                        <td class="py-2 px-4 border text-right font-bold bg-blue-50">${shares}</td>
                    </tr>
                `;
                tbody.innerHTML += tr;
            });
        }

        loadData();
    </script>
</body>
</html>
